<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Document</title>
</head>
<link rel="stylesheet" href="./../../dist/cssmin/head.min.css">
<style>

ul,li{
    list-style: none;
    padding: 0;
    margin: 0;
}
.info,.number,.xiaoji,.remove{
    display: inline-block;
}
.number .num{
    width: 50px;
}
</style>
<body>
        <div class="topNav">
                <div class="topNavCenter">
                    <div class="left">
                        <span>考拉欢迎您！</span>
                        <a href="./login.html">登陆</a>
                        <a href="./register.html">免费注册</a>
                        <a class="chart" href="javascript:0;">手机考拉
                        <span><img src="./../../static/images/chart.png"><p>下载APP</p>
                            <p>领1000元新人礼包</p>
                        </span>
                        </a>
                        <div class="vip"><span></span><a class="logout">退出</a></div>
                    </div>
                    <div class="right">
                        <ul>
                            <li><a href="">每日签到</a></li>
                            <li><a href="">我的订单</a></li>
                            <li class="three"><a href="">个人中心<i></i></a>
                            </li>
                            <li class="four"><a href="">客户服务<i></i></a></li>
                            <li class="five"><a href="">充值中心<i></i></a></li>
                            <li class="six"><a href="">消费者权益<i></i></a></li>
                            <li class="seven"><a href="">更多<i></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
        <!-- 头部logo -->
        <div class="header">
           <div class="headerCen">
                <a class="logo" href="./../index.html"><img src="./../../static/images/logo.png" ></a>
            <div class="headerSearch">
                    <div class="search">
                            <span class="iconfont">&#xe7a6;</span>
                            <input type="text">
                    </div>
                    <div class="button">
                            <span class="iconfont">&#xe7a6;</span>
                    </div>
            </div>
            <a class="cart" href="./cart.html">
                    <span class="iconfont">&#xe614;</span>购物车
            </a>
           </div>
        </div>
        <!-- 头部nav -->
        <div class="headerNav">
            <div class="headerNavCen">
                <div class="classfy">
                    <div class="all">
                            <span class="iconfont">&#xe64d;</span>全部分类
                    </div>
                    <ul>
                        <li><a href="./../views/list.html"><span class="iconfont">&#xe603;</span>美容彩妆<b>></b></a></li>
                        <li><a href="#"> <span class="iconfont">&#xe61a;</span>母婴儿童<b>></b></a></li>
                        <li><a href="#"> <span class="iconfont">&#xe61b;</span>营养保健<b>></b></a></li>
                        <li><a href="#"> <span class="iconfont">&#xe60d;</span>数码家电<b>></b></a></li>
                        <li><a href="#"> <span class="iconfont">&#xe638;</span>个人洗护<b>></b></a></li>
                        <li><a href="#"> <span class="iconfont">&#xe609;</span>服饰鞋靴<b>></b></a></li>
                        <li><a href="#"> <span class="iconfont">&#xe6ea;</span>运动户外<b>></b></a></li>
                        <li><a href="#"> <span class="iconfont">&#xe60a;</span>手表配饰<b>></b></a></li>
                        <li><a href="#"> <span class="iconfont">&#xe747;</span>极致轻奢<b>></b></a></li>
                        <li><a href="#"> <span class="iconfont">&#xe608;</span>家居生活<b>></b></a></li>
                        <li><a href="#"><span class="iconfont">&#xe621;</span>环球美食<b>></b></a></li>
                    </ul>
                </div>
                <ul>
                    <li><a href="">首页</a></li>
                    <li><a href="">今日限时购</a></li>
                    <li><a href="">每日上新</a></li>
                    <li><a href="">国家馆</a></li>
                    <li><a href="">海外旗舰店</a></li>
                    <li><a href="">工厂店</a></li>
                    <li><a href="">品质奶粉</a></li>
                    <li><a href="">人气面膜</a></li>
                    <li><a href="">充值</a></li>
                </ul>
            </div>
        </div>





        <div class="container">
                <li><input type="checkbox" class="checkAll">全选</li>
                        <ul>
                            <!-- <li>
                                <input type="checkbox" class="cheackOne">
                            <img src="./../../static/images/detailEvaluation4.jpg" width="100" height="100">
                            <span>天安门</span><b>价格：￥45.00</b>
                            <div class="number"><button>-</button><input type="number" class="number"><button>+</button></div>小计￥45.00
                            </li> -->
                            
                        </ul>
                <li><input type="checkbox" class="checkAll">全选</li>
                <p>总共：共<span class="numberCount">0</span>件商品，共计：￥<span class="priceCount">0.00</span>元</p>
                <button>结算</button>
     </div>
</body>
<script src="./../js/cookie.js"></script>
<script src="./../../node_modules/jquery/dist/jquery.js"></script>
<script>

var u=getCookie('username');
    if(u==undefined){
        document.querySelector(".topNav .vip").innerHTML="";
    }else{
        document.querySelector(".topNav .vip span").innerText=u;
        document.querySelector(".topNav .vip .logout").onclick=function(){
        delCookie("username");
        location.href='./login.html'
    }
    }



function loadPage(){
var str = localStorage.getItem("data");
// console.log(str)
if(str==null){
    return false;
}
var arr = JSON.parse(str);
var html="";
for(var i=0;i<arr.length;i++){
    html+=`
    <li>
            <input type="checkbox" class="checkOne">
        <img src="${arr[i].path}" width="100" height="100">
        <div class="info">
            <span>${arr[i].name}</span><b>价格：￥<strong>${arr[i].price}</strong></b>
        </div>
        <div class="number">
            <button class="cut">-</button>
            <input type="number" class="num" value="${arr[i].number}">
            <input type="hidden" name="stock" value="${arr[i].stock}">
            <button class="add">+</button>
        </div>
        <div class="xiaoji">小计￥<span class="xiaojiNum">${(arr[i].number*arr[i].price).toFixed(2)}</span></div>
        <button class="remove" data-id="${arr[i].id}">删除</button>
        </li>
    `
}
$(".container ul").html(html);
curadd();
checkOneClick();
}
loadPage();


//每个收藏的景点的复选框事件
function checkOneClick(){
    $(".container .checkOne").click(function(){
    var arr = Array.prototype.slice.call($(".checkOne"));
    var res=arr.every(function(v){
        // console.log($(v).prop("checked"))
        if($(v).prop("checked")){
            return true;
        }
    })
    if(res){
        $(".container .checkAll").prop("checked",true);
    }else{
        $(".container .checkAll").prop("checked",false);
    }
    count();
    })
    count();
    
}




function store(){
    var str = localStorage.getItem("data");
    var arr = JSON.parse(str);
    for(var i=0;i<arr.length;i++){
        $(".container .remove").attr("data-id").each(function(i,v){
            if(arr[i].id == $(v).attr("data-id")){
                arr[i].number = $(v).siblings(".number").children(".num").val()-0;
            }
        })
    }
    localStorage.clear();
    localStorage.setItem("data",JSON.stringify(arr))
    // lodePage();
}


function addup(){
    $(".container .xiaojiNum").each(function(k,v){
        var num = $(this).parent().siblings(".number").find(".num").val()-0;
        var price = parseFloat($(this).parent().siblings(".info").find("strong").text()).toFixed(2);
        $(this).text((price*num).toFixed(2));
    })
}



$(".container .checkAll").click(function(){
    var c=$(this).prop("checked");
    if(c){
        $(".container .checkAll").prop("checked",true)
        $(".container .checkOne").prop("checked",true)
    }else{
        $(".container .checkAll").prop("checked",false)
        $(".container .checkOne").prop("checked",false)
    }
    count();
})
function count(){
    var numberCount = 0;
    var xiaojiNum=0;
    $(".container .checkOne:checked").each(function(k,v){
        numberCount +=$(v).siblings(".number").children(".num").val()-0;
        xiaojiNum +=$(v).siblings(".xiaoji").children(".xiaojiNum").text()-0;
    });
    $(".container .numberCount").text(numberCount);
    $(".container .priceCount").text(xiaojiNum.toFixed(2));
}


function curadd(){
    $(".number").click(function(e){
    var target = e.target;
    if(target.className == "cut"){
        if($(this).find(".num").val()-1<=1){
            var num=1;
        }else{
            var num = $(this).find(".num").val()-1;
        }
        $(this).find(".num").val(num);
    }
    if(target.className == "add"){
        console.log()
        if($(this).find(".num").val()-0+1>=$(this).find("[name='stock']").val()-0){
            var num=$(this).find("[name='stock']").val()-0;
        }else{
            var num = $(this).find(".num").val()-0+1;
        }
        $(this).find(".num").val(num);
    }
    addup();

    stroe();

    count();
})
}



$(".container .remove").each(function(){
    $(this).click(function(){
        var arr = JSON.parse(localStorage.getItem("data"));
        var id =$(this).attr("data-id");
        var key;
        for(var i=0;i<arr.length;i++){
            if(arr[i].id==id){
                key = i;
            }
        }
        arr.splice(key,1);
        localStorage.setItem("data",JSON.stringify(arr)); 
        //重新加载页面
        loadPage();
    })
})

</script>
</html>